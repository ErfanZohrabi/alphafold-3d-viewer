<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AlphaFold 3D Protein Viewer</title>
    <!-- Import Mol* styles for the embedded viewer -->
    <link href="https://cdn.jsdelivr.net/npm/molstar@4.18.0/build/viewer/molstar.min.css" rel="stylesheet">
    <!--
      This page restructures the original index.html template from the
      `alphafold-3d-viewer` project to provide a more polished and
      information‚Äërich experience.  The navigation bar, hero section,
      descriptive sections (About, Examples, FAQ) and footer have been
      added to make the application easier to understand and use.  The
      existing search functionality and Mol* integration are preserved.
    -->
    <style>
        /* Global styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }

        a {
            color: #3498db;
            text-decoration: none;
        }

        /* Navigation bar */
        .navbar {
            background: #fff;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
            width: 100%;
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
        }

        .brand {
            font-size: 1.6rem;
            font-weight: 700;
            color: #2c3e50;
        }

        .nav-links {
            list-style: none;
            display: flex;
            gap: 20px;
        }

        .nav-links li a {
            font-weight: 500;
            padding: 5px 0;
            transition: color 0.3s ease;
        }

        .nav-links li a:hover {
            color: #764ba2;
        }

        /* Hero section */
        .hero {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            text-align: center;
            padding: 80px 20px;
        }

        .hero h1 {
            font-size: 2.8rem;
            margin-bottom: 20px;
            font-weight: 300;
        }

        .hero p {
            font-size: 1.2rem;
            margin-bottom: 40px;
            opacity: 0.9;
        }

        .search-container {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .search-input {
            flex: 1;
            min-width: 260px;
            padding: 15px;
            font-size: 16px;
            border: 2px solid #fff;
            border-radius: 10px;
            outline: none;
            color: #333;
        }

        .search-input::placeholder {
            color: rgba(0, 0, 0, 0.5);
        }

        .search-btn {
            padding: 15px 30px;
            font-size: 16px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .search-btn:hover {
            background: #2980b9;
        }

        .search-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* Sections */
        section {
            padding: 60px 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        section h2 {
            font-size: 2rem;
            margin-bottom: 20px;
            color: #2c3e50;
            font-weight: 500;
        }

        .about p {
            max-width: 800px;
            margin-bottom: 20px;
        }

        .about ul {
            list-style-type: disc;
            margin-left: 20px;
            max-width: 800px;
        }

        .examples .example-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .example-tag {
            background: #3498db;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .example-tag:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        /* Status message */
        .status {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-weight: 500;
            display: none;
        }

        .status.loading {
            background: #e3f2fd;
            color: #1976d2;
            display: block;
        }

        .status.success {
            background: #e8f5e8;
            color: #2e7d32;
            display: block;
        }

        .status.error {
            background: #ffebee;
            color: #c62828;
            display: block;
        }

        /* Protein information */
        .protein-info {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 40px;
            display: none;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .info-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }

        .info-label {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .info-value {
            color: #555;
        }

        /* 3D Viewer */
        .viewer-container {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin-bottom: 40px;
            display: none;
        }

        .viewer-header {
            background: #34495e;
            color: white;
            padding: 15px 20px;
            font-weight: 600;
        }

        #viewer {
            width: 100%;
            height: 600px;
            border: none;
        }

        .controls {
            background: #ecf0f1;
            padding: 15px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .control-btn {
            padding: 8px 16px;
            background: #95a5a6;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            background: #7f8c8d;
        }

        /* FAQ */
        .faq details {
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px 15px;
            background: #fff;
        }

        .faq summary {
            cursor: pointer;
            font-weight: 600;
            position: relative;
        }

        .faq summary::marker {
            color: #3498db;
        }

        .faq p {
            margin-top: 10px;
        }

        /* Footer */
        .footer {
            background: #2c3e50;
            color: white;
            text-align: center;
            padding: 30px 20px;
            font-size: 0.9rem;
        }

        .footer a {
            color: #85c1e9;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .hero h1 {
                font-size: 2rem;
            }
            .nav-links {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation bar -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="brand">AlphaFold 3D Viewer</div>
            <ul class="nav-links">
                <li><a href="#hero">Home</a></li>
                <li><a href="#about">About</a></li>
                <li><a href="#examples">Examples</a></li>
                <li><a href="#faq">FAQ</a></li>
            </ul>
        </div>
    </nav>

    <!-- Hero section with search bar -->
    <section id="hero" class="hero">
        <h1>Explore Biomolecular Structures</h1>
        <p>Search proteins and visualise their predicted 3D structures using the AlphaFold database.</p>
        <div class="search-container">
            <input type="text" id="query" class="search-input" placeholder="Enter UniProt ID, protein name, or sequence">
            <button id="searchBtn" class="search-btn" onclick="search()">üîç Search Structure</button>
        </div>
    </section>

    <!-- About section -->
    <section id="about" class="about">
        <h2>About This Viewer</h2>
        <p>
            This web‚Äëapp provides a simple interface to the <strong>AlphaFold</strong> database.  It allows you to
            search for proteins by <em>UniProt ID</em>, common name or raw amino acid sequence, and then
            interactively view their predicted 3D structures.  Results are presented using the
            <a href="https://molstar.org/" target="_blank">Mol*</a> viewer, an advanced WebGL visualiser for
            macromolecules.  Please note that these models are predictions and should be used for
            <strong>research and educational purposes only</strong>.
        </p>
        <ul>
            <li>Enter a valid UniProt identifier (e.g., <code>P05067</code>), protein name, or a peptide sequence of
                at least 10 residues.</li>
            <li>The app queries the AlphaFold API and returns the best available model along with
                metadata about the protein.</li>
            <li>Interact with the 3D structure: rotate, zoom, reset the view, spin the model or
                download the underlying PDB file.</li>
        </ul>
    </section>

    <!-- Examples section -->
    <section id="examples" class="examples">
        <h2>Try These Examples</h2>
        <div class="example-tags">
            <span class="example-tag" onclick="setQuery('P05067');">P05067 (Amyloid beta)</span>
            <span class="example-tag" onclick="setQuery('TP53');">TP53 (Tumour suppressor)</span>
            <span class="example-tag" onclick="setQuery('INS');">Insulin</span>
            <span class="example-tag" onclick="setQuery('HBB');">Hemoglobin</span>
        </div>
    </section>

    <!-- Status message -->
    <div id="status" class="status"></div>

    <!-- Protein information -->
    <div id="proteinInfo" class="protein-info">
        <h3>Protein Information</h3>
        <div id="infoGrid" class="info-grid"></div>
    </div>

    <!-- 3D Viewer -->
    <div id="viewerContainer" class="viewer-container" style="display: none;">
        <div id="viewerTitle" class="viewer-header"></div>
        <div id="viewer"></div>
        <div class="controls">
            <button class="control-btn" onclick="resetView()">üîÑ Reset View</button>
            <button class="control-btn" onclick="toggleSpin()">üîÑ Auto Rotate</button>
            <button class="control-btn" onclick="downloadStructure()">üíæ Download PDB</button>
            <button class="control-btn" onclick="toggleFullscreen()">‚õ∂ Fullscreen</button>
        </div>
    </div>

    <!-- FAQ section -->
    <section id="faq" class="faq">
        <h2>Frequently Asked Questions</h2>
        <details>
            <summary>What queries can I use?</summary>
            <p>You can search by UniProt accession (e.g. <code>P05067</code>), by common protein name (e.g. "Insulin"),
            or by an amino acid sequence of at least 10 residues.  The app will automatically detect
            the query type and select the appropriate search method.</p>
        </details>
        <details>
            <summary>How do I rotate or zoom the structure?</summary>
            <p>Click and drag inside the viewer to rotate the model.  Use your mouse wheel or trackpad
            to zoom in and out.  The control buttons below the viewer let you reset the camera,
            toggle automatic rotation and switch to full‚Äëscreen mode.</p>
        </details>
        <details>
            <summary>Why don't I see a result for my sequence?</summary>
            <p>AlphaFold predictions are available for most proteins but not all.  Ensure that your
            sequence contains only valid amino acid letters (A, C, D, E, F, G, H, I, K, L, M, N, P,
            Q, R, S, T, V, W, Y) and is at least 10 residues long.  If there is no matching entry
            in UniProt or the AlphaFold database, the server will return an error.</p>
        </details>
        <details>
            <summary>Can I use these models commercially?</summary>
            <p>No.  The AlphaFold structures provided through this site are intended for non‚Äëcommercial
            research and educational purposes only.  Consult the official AlphaFold licence and
            <a href="https://www.deepmind.com/open-source/alphafold" target="_blank">terms of use</a>
            for more details.</p>
        </details>
    </section>

    <!-- Footer -->
    <footer class="footer">
        Powered by <a href="https://alphafold.ebi.ac.uk" target="_blank">AlphaFold Database</a> &amp;
        <a href="https://molstar.org/" target="_blank">Mol*</a> Viewer&nbsp;|&nbsp;Built with Flask &amp; Python
    </footer>

    <!-- Import Mol* script -->
    <script src="https://cdn.jsdelivr.net/npm/molstar@4.18.0/build/viewer/molstar.min.js"></script>
    <script>
        // JavaScript from original template to handle search and visualisation
        let viewer;
        let isSpinning = false;
        let currentModelUrl = '';

        function setQuery(text) {
            document.getElementById('query').value = text;
        }

        function showStatus(message, type) {
            const status = document.getElementById('status');
            status.className = `status ${type}`;
            status.innerHTML = message;
        }

        function showProteinInfo(data) {
            const info = document.getElementById('proteinInfo');
            const grid = document.getElementById('infoGrid');
            const fields = [
                { label: 'UniProt ID', value: data.id },
                { label: 'Protein Name', value: data.protein_name },
                { label: 'Gene Name', value: data.gene_name },
                { label: 'Organism', value: data.organism },
                { label: 'Length (AA)', value: data.length + ' amino acids' },
                { label: 'Model Created', value: data.model_created ? new Date(data.model_created).toLocaleDateString() : 'Unknown' },
                { label: 'Confidence Score', value: data.confidence_score ? Math.round(data.confidence_score) + '%' : 'N/A' }
            ];
            grid.innerHTML = fields.map(field => `
                <div class="info-item">
                    <div class="info-label">${field.label}</div>
                    <div class="info-value">${field.value}</div>
                </div>
            `).join('');
            info.style.display = 'block';
        }

        async function search() {
            const query = document.getElementById('query').value.trim();
            const searchBtn = document.getElementById('searchBtn');
            if (!query) {
                showStatus('‚ùå Please enter a search query', 'error');
                return;
            }
            // Disable button and show loading
            searchBtn.disabled = true;
            searchBtn.innerHTML = '<div class="loading-spinner"></div>Searching...';
            showStatus('üîç Searching AlphaFold database...', 'loading');
            try {
                const response = await fetch('/search', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ query })
                });
                const data = await response.json();
                if (response.ok && data.model_url) {
                    showStatus('‚úÖ Structure found! Loading 3D model...', 'success');
                    showProteinInfo(data);
                    await loadStructure(data.model_url, data.protein_name || data.id);
                } else {
                    showStatus(`‚ùå ${data.error || 'Structure not found'}`, 'error');
                    document.getElementById('proteinInfo').style.display = 'none';
                    document.getElementById('viewerContainer').style.display = 'none';
                }
            } catch (error) {
                console.error('Search error:', error);
                showStatus('‚ùå Network error. Please try again.', 'error');
            } finally {
                // Re-enable button
                searchBtn.disabled = false;
                searchBtn.innerHTML = 'üîç Search Structure';
            }
        }

        async function loadStructure(url, title) {
            try {
                const container = document.getElementById('viewerContainer');
                const viewerTitle = document.getElementById('viewerTitle');
                container.style.display = 'block';
                viewerTitle.textContent = `3D Structure: ${title}`;
                currentModelUrl = url;
                if (!viewer) {
                    viewer = await molstar.Viewer.create('viewer', {
                        layoutShowControls: false,
                        layoutShowRemoteState: false,
                        layoutShowSequence: true,
                        layoutShowLog: false,
                        layoutShowLeftPanel: true,
                        viewportShowExpand: true,
                        viewportShowSelectionMode: false,
                        viewportShowAnimation: false
                    });
                } else {
                    await viewer.clear();
                }
                await viewer.loadStructureFromUrl(url, 'mmcif', false);
                showStatus('‚úÖ 3D structure loaded successfully!', 'success');
                // Scroll to viewer
                container.scrollIntoView({ behavior: 'smooth' });
            } catch (error) {
                console.error('Structure loading error:', error);
                showStatus('‚ùå Failed to load 3D structure', 'error');
            }
        }

        function downloadStructure() {
            if (currentModelUrl) {
                window.open(currentModelUrl, '_blank');
            }
        }

        function resetView() {
            if (viewer) {
                viewer.resetCamera();
            }
        }

        function toggleSpin() {
            if (viewer) {
                if (isSpinning) {
                    viewer.stopSpin();
                    isSpinning = false;
                } else {
                    viewer.spin();
                    isSpinning = true;
                }
            }
        }

        function toggleFullscreen() {
            const container = document.getElementById('viewer');
            if (document.fullscreenElement) {
                document.exitFullscreen();
            } else {
                container.requestFullscreen();
            }
        }

        // Enable search on Enter key once DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('query').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    search();
                }
            });
            // Show initial instructions
            showStatus('üí° Enter a UniProt ID, protein name, or amino acid sequence to get started', 'loading');
        });
    </script>
</body>
</html>
